<%- include("partials/header") -%>

<div class="heading">
    <h1>Update Profile</h1>
</div>
<div class="content">

    <div class="backgroundDiv update-background" >
        <div class="update-form">
            <form onsubmit="return updateProfile(this)">
                <img id="profile-image" style="width: 120px; height: 120px; border-radius: 100%; border: 2px solid black; margin: 7% 8%;" src="/public/icons/user.svg">
                <form id="profile-image-input" onsubmit="return false;">
                    <input type="file"  name="profileImage" accept="image/*" onchange= "uploadImage();" required  >
                </form>

                <textarea class="form-input aboutMe" name="About Me" id="aboutme" cols="30" rows="2" placeholder="About Me"></textarea>
                <input class="form-input name" type="text" required name="name" placeholder="Name">
                <input type="text" class="form-input dob" name="dob" required placeholder="DD/MM/YYYY" />
                <label class="form-input user-name" >Name</label>
                <label class="form-input email" >Email</label>
                <button name="submit" type="submit" >
                    <span>Update</span>
                </button>
                
            
            </form>

        </div>




    </div>
    

</div>

<script>

    var isUpdateProfile = true;

    function showProfileData(user)
    {   
        //document.querySelector(".profile-image").setAttribute("src", mainURL + "/" + user.profileImage);

        document.querySelector(".user-name").innerHTML = user.username;
		document.querySelector(".name").value = user.name;
		document.querySelector(".email").innerHTML = user.email;
        document.querySelector(".dob").value = user.dob;
        document.querySelector(".aboutMe").value = user.aboutMe;
    }


    window.onload = function()
    {
        showProfileData();
    };

    function uploadImage(form) {
        var form=document.getElementById("profile-image-input");
        var profileImage=form.profileImage;
		var ajax = new XMLHttpRequest();
		ajax.open("POST", "/uploadProfileImage", true);

		ajax.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {

				var response = JSON.parse(this.responseText);

				document.getElementById("profile-image").setAttribute("src", response.data);
			}
		};

        var formData = new FormData();
        formData.append("profileImage",profileImage);
		formData.append("accessToken", localStorage.getItem("accessToken"));
		ajax.send(formData);

		return false;
	}

</script>



<%- include("partials/footer") -%>